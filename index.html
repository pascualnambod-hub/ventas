<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Punto de Venta M√≥vil</title>

<style>
* {
  box-sizing: border-box;
  -webkit-text-size-adjust: 100%;
}

body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f4f4f4;
  padding: 8px;
}

h1, h2 {
  text-align: center;
  margin: 8px 0;
}

.pos {
  max-width: 100%;
  background: white;
  padding: 12px;
  border-radius: 12px;
}

/* PRODUCTOS */
.productos {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.productos button {
  padding: 20px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  background: #2196f3;
  color: white;
  cursor: pointer;
  touch-action: manipulation;
}

/* TABLA */
.table-wrap {
  overflow-x: auto;
  margin-top: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th, td {
  padding: 6px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}

.cant-btn {
  padding: 6px 10px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  color: white;
}

.mas { background: #4caf50; }
.menos { background: #f44336; }
.eliminar { background: #9c27b0; }

/* TOTAL Y PAGO */
.total {
  font-size: 22px;
  font-weight: bold;
  text-align: right;
  margin-top: 10px;
}

.pago {
  margin-top: 12px;
  background: #f1f1f1;
  padding: 10px;
  border-radius: 10px;
}

.pago label {
  font-size: 14px;
}

.pago input {
  width: 100%;
  padding: 14px;
  font-size: 24px;
  text-align: center;
  margin-top: 6px;
}

/* MENSAJE */
.mensaje {
  margin-top: 10px;
  font-size: 16px;
  color: green;
  text-align: center;
}

/* BOTONES */
.btn {
  width: 100%;
  margin-top: 10px;
  padding: 16px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

.btn-reset { background: #f44336; color: white; }
.btn-corte { background: #4caf50; color: white; }

/* MODAL */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 90%;
}

/* iPhone muy peque√±os */
@media (max-width: 360px) {
  .productos button { font-size: 16px; padding: 16px; }
  .pago input { font-size: 20px; }
}
</style>
</head>

<body>

<h1>üç∫ Punto de Venta</h1>

<div class="pos">

  <!-- PRODUCTOS -->
  <div class="productos">
    <button onclick="agregar('Mediana',20)">Mediana $20</button>
    <button onclick="agregar('Agua',10)">Agua $10</button>
    <button onclick="agregar('Bote',20)">Bote $20</button>
    <button onclick="agregar('Cart√≥n Mediana',400)">Cart√≥n $400</button>
    <button onclick="agregar('Six',110)">Six $110</button>
    <button onclick="agregar('Caguama',50)">Caguama $50</button>
    <button onclick="agregar('Pizza',30)">Pizza $30</button>
    <button onclick="agregar('Hot Dog',55)">Hot Dog $55</button>
  </div>

  <!-- TABLA -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Prod</th>
          <th>Cant</th>
          <th>$</th>
          <th>Sub</th>
          <th>‚ùå</th>
        </tr>
      </thead>
      <tbody id="tablaVenta"></tbody>
    </table>
  </div>

  <div class="total">Total: $<span id="total">0</span></div>

  <!-- PAGO -->
  <div class="pago">
    <label>Efectivo recibido (ENTER para cobrar)</label>
    <input type="number" id="efectivo" inputmode="decimal">
    <div class="total">Cambio: $<span id="cambio">0</span></div>
  </div>

  <div class="mensaje" id="mensaje"></div>

  <!-- REPORTE -->
  <div class="reporte">
    <h2>üìä Ventas del D√≠a</h2>
    <ul id="listaVentas"></ul>
    <div class="total">Total del D√≠a: $<span id="totalDia">0</span></div>

    <button class="btn btn-corte" onclick="abrirCorte()">üîê Corte de caja</button>
    <button class="btn btn-reset" onclick="reiniciarDia()">üîÅ Reiniciar d√≠a</button>
  </div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Corte de Caja</h2>
    <div id="contenidoCorte"></div>
    <button class="btn btn-corte" onclick="window.print()">üñ®Ô∏è Imprimir</button>
    <button class="btn btn-reset" onclick="cerrarModal()">Cerrar</button>
  </div>
</div>

<script>
const PASSWORD_CORTE = "1234";

let carrito = {};
let total = 0;
let esperandoCerrar = false;

const hoy = new Date().toLocaleDateString();
let ventasDia = JSON.parse(localStorage.getItem(hoy)) || [];

const efectivoInput = document.getElementById("efectivo");
const mensaje = document.getElementById("mensaje");

renderVentasDia();

efectivoInput.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    !esperandoCerrar ? cobrar() : cerrarVenta();
  }
});

efectivoInput.addEventListener("input", calcular);

function agregar(nombre, precio) {
  carrito[nombre]
    ? carrito[nombre].cantidad++
    : carrito[nombre] = { precio, cantidad: 1 };
  render();
}

function cambiarCantidad(p, c) {
  carrito[p].cantidad += c;
  if (carrito[p].cantidad <= 0) delete carrito[p];
  render();
}

function eliminarProducto(p) {
  delete carrito[p];
  render();
}

function render() {
  const t = document.getElementById("tablaVenta");
  t.innerHTML = "";
  total = 0;

  for (let p in carrito) {
    const i = carrito[p];
    const s = i.precio * i.cantidad;
    total += s;

    t.innerHTML += `
      <tr>
        <td>${p}</td>
        <td>
          <button class="cant-btn menos" onclick="cambiarCantidad('${p}',-1)">‚ûñ</button>
          ${i.cantidad}
          <button class="cant-btn mas" onclick="cambiarCantidad('${p}',1)">‚ûï</button>
        </td>
        <td>$${i.precio}</td>
        <td>$${s}</td>
        <td><button class="cant-btn eliminar" onclick="eliminarProducto('${p}')">‚ùå</button></td>
      </tr>`;
  }

  calcular();
}

function calcular() {
  document.getElementById("total").innerText = total;
  const efectivo = parseFloat(efectivoInput.value) || 0;
  document.getElementById("cambio").innerText =
    efectivo >= total ? efectivo - total : 0;
}

function cobrar() {
  const efectivo = parseFloat(efectivoInput.value) || 0;
  if (total === 0 || efectivo < total) return;

  ventasDia.push({ hora: new Date().toLocaleTimeString(), total });
  localStorage.setItem(hoy, JSON.stringify(ventasDia));
  renderVentasDia();

  mensaje.innerText = `‚úî Venta guardada | Cambio: $${efectivo - total}`;
  esperandoCerrar = true;
}

function cerrarVenta() {
  carrito = {};
  total = 0;
  document.getElementById("tablaVenta").innerHTML = "";
  efectivoInput.value = "";
  document.getElementById("cambio").innerText = 0;
  mensaje.innerText = "";
  esperandoCerrar = false;
  render();
}

function renderVentasDia() {
  const l = document.getElementById("listaVentas");
  l.innerHTML = "";
  let suma = 0;

  ventasDia.forEach(v => {
    suma += v.total;
    l.innerHTML += `<li>${v.hora} ‚Äî $${v.total}</li>`;
  });

  document.getElementById("totalDia").innerText = suma;
}

function abrirCorte() {
  const pass = prompt("Contrase√±a:");
  if (pass !== PASSWORD_CORTE) return alert("Contrase√±a incorrecta");

  document.getElementById("contenidoCorte").innerHTML = `
    <p>üìÖ Fecha: ${hoy}</p>
    <p>üßæ Ventas: ${ventasDia.length}</p>
    <p>üí∞ Total: $${ventasDia.reduce((a,b)=>a+b.total,0)}</p>
    <p>‚è∞ Hora: ${new Date().toLocaleTimeString()}</p>
  `;
  document.getElementById("modal").style.display = "flex";
}

function reiniciarDia() {
  const pass = prompt("Contrase√±a:");
  if (pass !== PASSWORD_CORTE) return alert("Contrase√±a incorrecta");
  localStorage.removeItem(hoy);
  ventasDia = [];
  renderVentasDia();
}

function cerrarModal() {
  document.getElementById("modal").style.display = "none";
}
</script>

</body>
</html>
